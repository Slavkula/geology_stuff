import openpyxl
from docx import Document
import tkinter as tk
from tkinter import filedialog, Entry, Label, Button, Toplevel, Text, END

def replace_words():
    # Открываем файл Excel
    workbook = openpyxl.load_workbook(excel_file.get())
    sheet = workbook['Лист1']

    # Открываем файл Word
    doc = Document(word_file.get())

    # Создаем новый файл Word
    new_doc = Document()

    # Цикл для обработки строк в Excel
    for row in range(1, 200):  #  обработать 200 строк
        # Получаем значения из ячеек
        values = [sheet.cell(row, i).value for i in range(1, 9)]

        # Проверяем, что значения не пустые
        if all(value is not None for value in values):
            # Обновляем значения в тексте
            for paragraph in doc.paragraphs:
                updated_text = paragraph.text
                for word, value in zip(words, values):
                    if word.get():
                        updated_text = updated_text.replace(word.get(), str(value))
                new_doc.add_paragraph(updated_text)

    # Сохраняем новый файл Word
    new_doc.save('BOBER KURWA.docx')

def show_macro():
    macro_text = """
Sub OdnaStroka()
    Dim cell As Range
    For Each cell In Range("C1:C" & Cells(Rows.Count, "C").End(xlUp).Row) 
        If InStr(cell.Value, Chr(10)) > 0 Then 
            cell.Value = Replace(cell.Value, Chr(10), " ") 
        End If
    Next cell
End Sub
"""
    popup = Toplevel(root)
    popup.title("Макрос")
    popup.geometry("400x300")
    macro_display = Text(popup)
    macro_display.insert(END, macro_text)
    macro_display.pack()

root = tk.Tk()

excel_file = tk.StringVar()
word_file = tk.StringVar()
words = [tk.StringVar() for _ in range(8)]

Label(root, text="Файл Excel:").grid(row=0, column=0)
Entry(root, textvariable=excel_file).grid(row=0, column=1)
Button(root, text="Выбрать файл Excel", command=lambda: excel_file.set(filedialog.askopenfilename())).grid(row=0, column=2)

Label(root, text="Файл Word:").grid(row=1, column=0)
Entry(root, textvariable=word_file).grid(row=1, column=1)
Button(root, text="Выбрать файл Word", command=lambda: word_file.set(filedialog.askopenfilename())).grid(row=1, column=2)

for i in range(8):
    Label(root, text=f"Слово {i+1}:").grid(row=i+2, column=0)
    Entry(root, textvariable=words[i]).grid(row=i+2, column=1)

Button(root, text="Заменить слова", command=replace_words).grid(row=10, column=1)
Button(root, text="Показать макрос", command=show_macro).grid(row=10, column=2)

instructions = """
Всегда внимательно подготавливай файлы ворда и экселя.
Всегда делай копии этих файлов.
Выбирай такие слова, которых нет в тексте совсем:
если будет слово "один" и "одинаковый" программа испортит все слова,
в которых встречается "один".
1. Выбирай файл ворда, в котором будут делаться замены.
2. Выбираешь файл экселя, из которого будут браться данные для замены. 
3. Записываешь слова, которые надо заменить:
а) Слова в подготовленном тексте пишешь заранее.
б) Используются ячейки экселя от А до D
в) Используются значения от 1 до 200, пустые будут пропущены.
4. Нажимаешь "заменить слова"
5. В папке с программой появится файл "BOBER KURWA" в нём готовый текст.
Кнопка макроса покажет макрос для экселя, который сделает ячейки в одну строку.
"""
Label(root, text=instructions).grid(row=11, column=0, columnspan=3)

root.mainloop()
